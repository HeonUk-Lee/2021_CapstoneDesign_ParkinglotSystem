# 2021_CapstoneDesign_ParkinglotSystem
Parking space tracking system with Deep Learning
2021년 1학기 캡스톤디자인 과제

## 구성원

### 이헌욱 (20163075)

[git 주소](https://github.com/HeonUk-Lee)

### 이현학 (20163076)

[git 주소](https://github.com/hh0260)

## 실행 환경

- Language : Python
- Python version "3.8.5" 
- Window 10 64bit

## 요약
 매일같이 자가용으로 출퇴근하는 직장인들을 비롯하여 수많은 운전자들은 주차 전쟁의 시대에 살고 있다. 인구가 밀집되어있거나 주차장이 부족한 지역의 경우 잠시 주차 자리를 비우고 돌아오면 다른 주차공간을 찾기 위해 돌아다녀야 할 정도로 주차공간 부족의 체감이 심한 편이다. 심지어 아파트 단지 사이의 주차장이나 공영주차장과 같은 대부분의 야외주차장에서는 주차공간이 존재하는지, 빈자리가 어디에 있는지 직접 가서 확인해보기 전까지는 알 방법이 없어서 불편한 점이 있다. 
 이러한 문제의 해결 방안으로 대형마트의 주차장이나 일부 공영주차장처럼 설계 및 시공단계에서부터 각 주차면에 센서를 달아 운전자들에게 주차 정보를 미리 제공하는 방법이 있다. 하지만 이는 기존의 센서가 없는 주차장은 해당이 없으며, 모든 주차면에 센서를 부착하는 것은 금전적으로도 적지 않은 돈이 필요하다. 
 본 문서는 기존의 주차 문제를 해결하면서 금전적인 부분도 고려하기 위해 딥러닝을 이용한 주차공간 추적 시스템에 대한 보고서이다. 이 주차공간 추적 시스템은 센서가 달렸지 않은 기존의 주차장으로부터 실시간 영상소스를 받을 수만 있다면 딥러닝을 통해 실시간으로 주차 정보를 분석할 수 있고, 사용자들은 언제 어디서든 스마트폰 앱을 통해 원하는 주차장의 정보를 확인할 수 있어서 주차공간을 찾는 불편함을 크게 개선해줄 것이다. 
 주차공간의 유무는 CNN 모델을 이용해 주차 중인 공간과 비어있는 공간을 분류하였다. Roboflow의 PKLot 데이터 세트와 직접 구한 데이터 세트를 혼합하여 학습시켰으며, 학습된 모델을 통해 각 주차면의 주차 정보를 OpenCV를 이용하여 한눈에 알기 쉽게 표현하였다. 최종사용자는 앱의 메인 화면에서 원하는 주차 정보를 확인할 수 있고, 빈자리 위치 또한 실시간 영상으로 확인할 수 있다. 


## 실행 방법
### 1. 관리자 프로그램
- video.h264 파일을 다운로드 후 프로그램 폴더에 넣는다.
- Main_ui.py 파일을 실행한다.

### 2. 사용자 모바일 앱
- 사용자 모바일 앱은 관리자가 SelectPark.java내의 'urlAddress'을 관리자 프로그램에서 송출하는 url로 수정 후 사용한다.

## 프로그램 구성 요소

### CNN.py
train_data 폴더 내의 이미지셋을 이용하여 CNN 이미지 분류 모델을 학습시키고 해당 모델을 저장합니다.


### get_line.py

실시간 주차영상을 받아와서 주차선을 설정합니다.

OpenCV를 활용하여 받은 사용자의 마우스 입력을 통해 주차선의 좌표를 텍스트 파일로 저장합니다.
![line](https://user-images.githubusercontent.com/74241873/110746580-5a756580-8280-11eb-9b4a-16bea89b6b1b.jpg)


### output.py

get_line.py에서 생성된 좌표와 미리학습된 모델을 활용하여 해당 좌표 내 공간이 주자가능 영역인지 아닌지를 판단합니다.

주차가능한 구역은 초록색, 불가능한 구역은 빨간색으로 표시합니다. 
![image](https://user-images.githubusercontent.com/74241873/110746807-b3dd9480-8280-11eb-82a3-aaef5fdda1b2.png)


### stream.py
실시간 처리된 영상을 다시 웹스트리밍합니다.

## 테스트영상 다운로드
https://drive.google.com/file/d/18kJNkTtR4ZJDcZvqszIgex-rzL48oF8y/view?usp=sharing
